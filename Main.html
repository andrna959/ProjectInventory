<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Inventory App</title>
  
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>

  <style>
    :root {
      --sidebar-width: 260px;
      --primary: #2c3e50;
      --accent: #3498db;
      --bg-light: #f4f7f6;
    }
    body { font-family: 'Inter', sans-serif; background: var(--bg-light); color: #333; overflow-x: hidden; }

    /* SIDEBAR STYLE */
    .sidebar {
      position: fixed; top: 0; left: 0; height: 100vh; width: var(--sidebar-width);
      background: #fff; border-right: 1px solid #e1e4e8; z-index: 1000;
      display: flex; flex-direction: column; transition: transform 0.3s;
    }
    .sidebar-header { padding: 20px; border-bottom: 1px solid #f0f0f0; display: flex; align-items: center; gap: 10px; }
    .brand { font-weight: 700; color: var(--primary); font-size: 1.2rem; }
    .nav-menu { padding: 15px; flex: 1; overflow-y: auto; }
    .nav-item {
      display: flex; align-items: center; padding: 12px; margin-bottom: 5px;
      color: #636e72; text-decoration: none; border-radius: 8px; font-weight: 500; cursor: pointer; transition: 0.2s;
    }
    .nav-item:hover { background: #f8f9fa; color: var(--accent); }
    .nav-item.active { background: #e3f2fd; color: var(--accent); font-weight: 600; }
    .nav-item i { margin-right: 10px; font-size: 20px; }
    .nav-label { font-size: 11px; font-weight: 700; color: #b2bec3; text-transform: uppercase; margin: 15px 10px 5px; }

    /* CONTENT AREA */
    .main-wrapper { margin-left: var(--sidebar-width); padding: 30px; transition: margin-left 0.3s; }
    
    /* MOBILE RESPONSIVE */
    .mobile-toggle { display: none; position: fixed; top: 15px; left: 15px; z-index: 1001; background: #fff; border: 1px solid #ddd; padding: 5px; border-radius: 4px; }
    @media (max-width: 768px) {
      .sidebar { transform: translateX(-100%); }
      .sidebar.open { transform: translateX(0); }
      .main-wrapper { margin-left: 0; padding: 15px; padding-top: 60px; }
      .mobile-toggle { display: block; }
    }

    /* ANIMATION */
    .fade-in { animation: fadeIn 0.4s ease; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
  </style>
</head>
<body>

  <button class="mobile-toggle" onclick="toggleSidebar()"><i class="material-icons">menu</i></button>

  <aside class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <i class="material-icons" style="font-size: 32px; color: var(--accent);">inventory_2</i>
      <div class="brand">Gudang App</div>
    </div>
    
    <nav class="nav-menu">
      <a class="nav-item active" onclick="loadPage('dashboard', this)"><i class="material-icons">dashboard</i> Dashboard</a>
      
      <div class="nav-label">Transaksi</div>
      <a class="nav-item" onclick="loadPage('barang-masuk', this)"><i class="material-icons">input</i> Barang Masuk</a>
      <a class="nav-item" onclick="loadPage('barang-keluar', this)"><i class="material-icons">output</i> Barang Keluar</a>
      <a class="nav-item" onclick="loadPage('stok-opname', this)"><i class="material-icons">fact_check</i> Stok Opname</a>
      
      <div class="nav-label">Data Master</div>
      <a class="nav-item" onclick="loadPage('produk', this)"><i class="material-icons">inventory</i> Data Produk</a>
      <a class="nav-item" onclick="loadPage('laporan-opname', this)"><i class="material-icons">assessment</i> Laporan</a>
    </nav>
  </aside>

  <main class="main-wrapper">
    <div id="loader" style="display:none; text-align:center; margin-top:50px;">
      <div class="spinner-border text-primary"></div><p>Memuat...</p>
    </div>
    
    <div id="app-content"></div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <script>
    // Load Dashboard saat pertama kali
    document.addEventListener("DOMContentLoaded", () => loadPage('dashboard'));

    function loadPage(pageName, el) {
      if(el) {
        document.querySelectorAll('.nav-item').forEach(e => e.classList.remove('active'));
        el.classList.add('active');
        if(window.innerWidth <= 768) toggleSidebar();
      }

      const content = document.getElementById('app-content');
      const loader = document.getElementById('loader');
      
      content.style.display = 'none';
      loader.style.display = 'block';

      google.script.run
        .withSuccessHandler(html => {
          loader.style.display = 'none';
          content.innerHTML = html;
          content.style.display = 'block';
          content.classList.add('fade-in');
          executeScripts(content); // Jalankan script halaman
        })
        .withFailureHandler(err => {
          loader.style.display = 'none';
          Swal.fire('Error', err.message, 'error');
        })
        .loadPageContent(pageName);
    }

    // Fungsi penting untuk menjalankan script di dalam HTML yang di-inject
    function executeScripts(container) {
      const scripts = container.getElementsByTagName("script");
      for (let i = 0; i < scripts.length; i++) {
        // Jangan jalankan ulang library yang sudah ada di head
        if (!scripts[i].src && !scripts[i].type.includes('html5-qrcode')) {
           try { eval(scripts[i].innerText); } catch(e) { console.error("Script Error:", e); }
        }
      }
    }

    function toggleSidebar() { document.getElementById('sidebar').classList.toggle('open'); }
  </script>
</body>
</html>
